<!DOCTYPE html><html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Restaurant Admin Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script><style>
:root{
--bg1:#0b1220;
--bg2:#0e1a33;
--card:linear-gradient(135deg,#182338,#0f1b2e);
--accent:linear-gradient(90deg,#ff4ecd,#6a8dff);
--green:#22c55e;
--orange:#f59e0b;
--red:#ef4444;
}

*{box-sizing:border-box;font-family:Poppins,sans-serif}

body{
margin:0;
background:radial-gradient(circle at top,var(--bg2),var(--bg1));
color:#fff;
}

header{
display:flex;
justify-content:space-between;
padding:20px;
align-items:center;
}

.live-indicator{
background:#062;
padding:6px 14px;
border-radius:20px;
color:#0f0;
}

.container{padding:15px;max-width:900px;margin:auto}

.card{
background:var(--card);
padding:20px;
border-radius:16px;
margin-bottom:12px;
box-shadow:0 10px 25px rgba(0,0,0,.4);
cursor:pointer;
}

.grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}

.section{margin-top:20px}

.section-title{font-size:20px;margin-bottom:10px}

.order-card{
background:var(--card);
padding:15px;
border-radius:14px;
margin-bottom:10px;
}

.btn{
background:var(--accent);
border:none;
padding:6px 12px;
border-radius:10px;
color:#fff;
margin:5px 5px 0 0;
cursor:pointer;
}

.btn-red{background:#ef4444}
.btn-green{background:#22c55e}
.btn-orange{background:#f59e0b}

.hidden{display:none}

input{width:100%;padding:10px;border-radius:10px;border:none;margin-top:8px}

.popup{
position:fixed;
top:20px;
right:20px;
background:#111;
padding:15px;
border-radius:12px;
box-shadow:0 0 20px rgba(0,0,0,.6);
display:none;
z-index:999;
}

</style></head>
<body><header>
<h2>üçΩ Restaurant Admin</h2>
<div class="live-indicator">‚óè Live</div>
</header><div class="container"><!-- SUMMARY --><div class="card" onclick="openSection('revenue-section')">
<h1 id="revenueToday">‚Çπ0</h1>
<p>Revenue Today</p>
</div><div class="card" onclick="openSection('live-section')">
<h1 id="activeOrders">0</h1>
<p>Active Orders</p>
</div><div class="grid">
<div class="card" onclick="openSection('live-section')">üì¶ Live Orders</div>
<div class="card" onclick="openSection('manage-dishes-section')">üçΩ Manage Dishes</div>
<div class="card" onclick="openSection('billing-section')">üßæ Generate Bill</div>
<div class="card" onclick="downloadCSV()">‚¨á Download Report</div>
</div><!-- LIVE ORDERS --><div id="live-section" class="section">
<div class="section-title">üî¥ Live Orders</div>
<div id="liveOrdersContainer"></div>
</div><!-- BILLING --><div id="billing-section" class="section hidden">
<div class="section-title">Generate Bill</div>
<input id="tableInput" placeholder="Table number">
<button class="btn" onclick="generateBill()">Generate</button>
<div id="billResult"></div>
</div><!-- DISHES --><div id="manage-dishes-section" class="section hidden">
<div class="section-title">Manage Dishes</div>
<input id="dishName" placeholder="Name">
<input id="dishPrice" placeholder="Price">
<input id="dishCategory" placeholder="Category">
<input id="dishImage" placeholder="Image URL">
<button class="btn" onclick="addDish()">Add Dish</button>
<div id="dishesList"></div>
</div></div><div id="orderPopup" class="popup"></div>
<div id="waiterPopup" class="popup" style="top:90px"></div><script>

const SUPABASE_URL="YOUR_URL"
const SUPABASE_KEY="YOUR_KEY"

const supabase=window.supabase.createClient(SUPABASE_URL,SUPABASE_KEY)


function openSection(id){
document.querySelectorAll('.section').forEach(s=>s.classList.add('hidden'))
document.getElementById(id).classList.remove('hidden')
}


// DASHBOARD
async function loadDashboard(){

const {data}=await supabase.from('orders').select('*')

let revenue=0
let active=0

const today=new Date().toISOString().slice(0,10)


data.forEach(o=>{
if(o.created_at.startsWith(today)){
revenue+=Number(o.total)
if(o.status!='billed')active++
}
})

revenueToday.innerText="‚Çπ"+revenue
activeOrders.innerText=active

}


// LIVE ORDERS
async function loadLiveOrders(){

const {data}=await supabase
.from('orders')
.select('*')
.eq('billed',false)

const box=document.getElementById('liveOrdersContainer')
box.innerHTML=""

for(const o of data){

box.innerHTML+=`
<div class="order-card">
Table ${o.table_number}<br>
Total ‚Çπ${o.total}<br>
Status: ${o.status}<br>
<button class="btn btn-orange" onclick="updateStatus('${o.id}','preparing')">Preparing</button>
<button class="btn btn-green" onclick="updateStatus('${o.id}','completed')">Completed</button>
<button class="btn" onclick="billOrder('${o.id}')">Generate Bill</button>
</div>
`

}

}


async function updateStatus(id,status){
await supabase.from('orders').update({status}).eq('id',id)
loadLiveOrders()
}


async function billOrder(id){
await supabase.from('orders').update({billed:true,status:'billed'}).eq('id',id)
loadLiveOrders()
}


// BILL VIEW
async function generateBill(){

const table=tableInput.value

const {data}=await supabase
.from('orders')
.select('*')
.eq('table_number',table)
.eq('billed',false)

let total=0
let html=""

for(const o of data){
html += `Order ‚Çπ${o.total}<br>`
total+=Number(o.total)
}

html += `<hr>Total ‚Çπ${total}`

billResult.innerHTML=html

}


// DISHES
async function loadDishes(){

const {data}=await supabase.from('dishes').select('*')

const box=document.getElementById('dishesList')
box.innerHTML=""

for(const d of data){

box.innerHTML+=`
<div class="order-card">
${d.name} ‚Çπ${d.price}<br>
${d.available?"":"<span style='color:red'>Out of stock</span>"}
<br>
<button class="btn" onclick="editDish('${d.id}','${d.name}','${d.price}')">Edit</button>
<button class="btn btn-red" onclick="deleteDish('${d.id}')">Delete</button>
<button class="btn btn-orange" onclick="toggleDish('${d.id}',${d.available})">
${d.available?'Mark Out of Stock':'Mark Available'}
</button>
</div>
`

}

}


async function addDish(){
await supabase.from('dishes').insert({
name:dishName.value,
price:dishPrice.value,
category:dishCategory.value,
image:dishImage.value,
available:true
})
loadDishes()
}


async function deleteDish(id){
await supabase.from('dishes').delete().eq('id',id)
loadDishes()
}


async function toggleDish(id,state){
await supabase.from('dishes').update({available:!state}).eq('id',id)
loadDishes()
}


function editDish(id,name,price){

const newName=prompt("Edit name",name)
const newPrice=prompt("Edit price",price)

supabase.from('dishes')
.update({name:newName,price:newPrice})
.eq('id',id)
.then(loadDishes)

}


// CSV
async function downloadCSV(){

const {data}=await supabase.from('orders').select('*')

let csv="table,total,date\n"

for(const o of data){
csv+= `${o.table_number},${o.total},${o.created_at}\n`
}

const blob=new Blob([csv])
const a=document.createElement('a')
a.href=URL.createObjectURL(blob)
a.download="report.csv"
a.click()

}


// NOTIFICATIONS

function showPopup(el,msg,sound){

const box=document.getElementById(el)
box.innerText=msg
box.style.display="block"

new Audio(sound).play()

setTimeout(()=>box.style.display="none",4000)

}


// realtime orders
supabase.channel('orders')
.on('postgres_changes',{event:'INSERT',schema:'public',table:'orders'},payload=>{

showPopup("orderPopup","New order Table "+payload.new.table_number,
"https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg")

loadLiveOrders()
loadDashboard()

}).subscribe()


// realtime waiter
supabase.channel('waiter')
.on('postgres_changes',{event:'INSERT',schema:'public',table:'waiter_calls'},payload=>{

showPopup("waiterPopup","Waiter called Table "+payload.new.table_number,
"https://actions.google.com/sounds/v1/alarms/beep_short.ogg")

}).subscribe()


loadDashboard()
loadLiveOrders()
loadDishes()

</script></body>
</html>