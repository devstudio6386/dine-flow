<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<meta name="version" content="1.0.0">
  <title>Grand Spice Restaurant</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&amp;family=Poppins:wght@300;400;500;600;700&amp;family=Space+Grotesk:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    :root {
      --pink-hot: #FF006E;
      --pink-light: #FF4DA6;
      --blue-electric: #00D4FF;
      --blue-deep: #0066FF;
      --purple-mid: #8B00FF;
      --card-glass: rgba(255, 255, 255, 0.06);
      --card-border: rgba(255, 105, 180, 0.2);
    }

    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #0D001A 0%, #1A0030 50%, #000D1A 100%);
      background-attachment: fixed;
    }

    .app-wrapper {
      min-height: 100%;
      width: 100%;
      overflow-x: hidden;
    }

    .font-display { font-family: 'Playfair Display', serif; }
    .font-mono { font-family: 'Space Grotesk', monospace; }

    .gradient-text {
      background: linear-gradient(135deg, #FF006E, #8B00FF, #00D4FF);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .gradient-border {
      position: relative;
      background: var(--card-glass);
      border: 1px solid transparent;
    }

    .gradient-border::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: inherit;
      padding: 1px;
      background: linear-gradient(135deg, rgba(255,0,110,0.4), rgba(0,212,255,0.4));
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      pointer-events: none;
    }

    .glass-card {
      background: rgba(255, 255, 255, 0.06);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 105, 180, 0.2);
    }

    .glass-card:hover {
      background: linear-gradient(135deg, rgba(255,0,110,0.15), rgba(0,212,255,0.15));
      border-color: rgba(255, 105, 180, 0.4);
    }

    .glow-pink { box-shadow: 0 0 20px rgba(255, 0, 110, 0.4); }
    .glow-blue { box-shadow: 0 0 20px rgba(0, 212, 255, 0.4); }

    .search-focus:focus {
      border-color: var(--pink-hot);
      box-shadow: 0 0 0 2px rgba(255,0,110,0.3), 0 0 20px rgba(0,212,255,0.2);
    }

    .hide-scrollbar::-webkit-scrollbar { display: none; }
    .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

    @keyframes float {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-10px) rotate(5deg); }
    }

    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 20px rgba(255, 0, 110, 0.4); }
      50% { box-shadow: 0 0 40px rgba(0, 212, 255, 0.6); }
    }

    @keyframes slide {
      0% { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }

    .animate-float { animation: float 3s ease-in-out infinite; }
    .animate-pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }

    .carousel-container {
      overflow: hidden;
      position: relative;
    }

    .carousel-track {
      display: flex;
      transition: transform 0.5s ease-in-out;
    }

    .carousel-slide {
      min-width: 100%;
      flex-shrink: 0;
    }

    .toggle-switch {
      width: 44px;
      height: 24px;
      background: rgba(255,255,255,0.2);
      border-radius: 12px;
      position: relative;
      cursor: pointer;
      transition: all 0.3s;
    }

    .toggle-switch.active {
      background: linear-gradient(90deg, #22C55E, #00D4FF);
      box-shadow: 0 0 15px rgba(34, 197, 94, 0.5);
    }

    .toggle-switch::after {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: all 0.3s;
    }

    .toggle-switch.active::after {
      left: 22px;
    }

    .category-ring {
      position: relative;
    }

    .category-ring.active::before {
      content: '';
      position: absolute;
      inset: -3px;
      border-radius: 50%;
      background: linear-gradient(135deg, #FF006E, #00D4FF);
      z-index: -1;
    }

    .btn-gradient {
      background: linear-gradient(135deg, #FF006E, #8B00FF);
      transition: all 0.3s;
    }

    .btn-gradient:hover {
      background: linear-gradient(135deg, #FF4DA6, #00D4FF);
      transform: scale(1.02);
      box-shadow: 0 0 30px rgba(255, 0, 110, 0.5);
    }

    .food-card {
      transition: all 0.3s ease;
    }

    .food-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
    }

    .veg-badge {
      width: 16px;
      height: 16px;
      border: 2px solid #22C55E;
      border-radius: 3px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .veg-badge::after {
      content: '';
      width: 8px;
      height: 8px;
      background: #22C55E;
      border-radius: 50%;
    }

    .non-veg-badge {
      width: 16px;
      height: 16px;
      border: 2px solid #EF4444;
      border-radius: 3px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .non-veg-badge::after {
      content: '';
      width: 0;
      height: 0;
      border-left: 4px solid transparent;
      border-right: 4px solid transparent;
      border-bottom: 8px solid #EF4444;
    }

    .cart-badge {
      position: absolute;
      top: -8px;
      right: -8px;
      background: linear-gradient(135deg, #FF006E, #FF4DA6);
      color: white;
      font-size: 11px;
      font-weight: 700;
      min-width: 20px;
      height: 20px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 10px rgba(255, 0, 110, 0.6);
    }

    .quantity-btn {
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #FF006E, #8B00FF);
      border-radius: 6px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
    }

    .quantity-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 0 15px rgba(255, 0, 110, 0.5);
    }

    .shimmer {
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }

    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }

    .cart-panel {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(180deg, rgba(26, 0, 48, 0.98), rgba(13, 0, 26, 0.98));
      backdrop-filter: blur(20px);
      border-top: 1px solid rgba(255, 105, 180, 0.3);
      transform: translateY(100%);
      transition: transform 0.4s ease;
      max-height: 70%;
      overflow-y: auto;
      z-index: 100;
    }

    .cart-panel.open {
      transform: translateY(0);
    }

    .loading-overlay {
      position: fixed;
      inset: 0;
      background: rgba(13, 0, 26, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 200;
    }

    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 3px solid rgba(255, 0, 110, 0.3);
      border-top-color: #FF006E;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
  <style>body { box-sizing: border-box; }</style>
 </head>
 <body>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>

// =====================================================
// VERSION CONTROL (FORCE REFRESH WHEN UPDATED)
// =====================================================

const APP_VERSION = "1.0.0";

if(localStorage.getItem("app_version") !== APP_VERSION){

localStorage.clear();

localStorage.setItem("app_version", APP_VERSION);

location.reload(true);

}


// =====================================================
// DISABLE SERVICE WORKER CACHE (ANTI CACHE)
// =====================================================

if("serviceWorker" in navigator){

navigator.serviceWorker.getRegistrations()
.then(regs => regs.forEach(r => r.unregister()));

}


// =====================================================
// SUPABASE CONFIG WITH CACHE DISABLED
// =====================================================

const SUPABASE_URL = "https://YOUR_PROJECT.supabase.co";
const SUPABASE_ANON_KEY = "YOUR_PUBLIC_ANON_KEY";

const supabase = window.supabase.createClient(
SUPABASE_URL,
SUPABASE_ANON_KEY,
{
global:{
fetch:(url,options={})=>{

options.cache="no-store";

options.headers={
...options.headers,
"Cache-Control":"no-cache"
};

return fetch(url,options);

}
}
}
);


// =====================================================
// GET RESTAURANT SLUG SAFELY
// =====================================================

function getRestaurantSlug(){

let path = window.location.pathname;

if(path.endsWith("/")){

path = path.slice(0,-1);

}

const parts = path.split("/");

return parts[parts.length-1];

}

const restaurantSlug = getRestaurantSlug();


// =====================================================
// TABLE NUMBER
// =====================================================

const urlParams = new URLSearchParams(window.location.search);

const tableNumber = urlParams.get("table");


// =====================================================
// STATE
// =====================================================

let restaurant=null;
let menuData=[];
let categories=[];
let cartItems=[];

let vegModeActive=false;
let activeCategory="all";


// =====================================================
// SAFE IMAGE URL (ANTI CACHE)
// =====================================================

function safeImage(url){

if(!url) return "";

return url + "?v=" + Date.now();

}


// =====================================================
// LOAD RESTAURANT
// =====================================================

async function loadRestaurant(){

try{

const {data,error} = await supabase
.from("restaurants")
.select("*")
.eq("slug",restaurantSlug)
.single();

if(error || !data){

document.getElementById("restaurant-display").innerText=
"Restaurant not found";

return;
}

restaurant=data;

document.getElementById("restaurant-display").innerText=data.name;

document.getElementById("table-display").innerText =
tableNumber ? "Table "+tableNumber : "Online Order";

}catch(e){

console.log(e);

}

}


// =====================================================
// LOAD CATEGORIES
// =====================================================

async function loadCategories(){

if(!restaurant) return;

const {data,error} = await supabase
.from("categories")
.select("*")
.eq("restaurant_id",restaurant.id)
.order("name");

if(error){

console.log(error);

return;
}

categories = [

{id:"all", name:"All", image_url:null},

...data

];

renderCategories();

}


// =====================================================
// LOAD MENU
// =====================================================

async function loadMenu(){

if(!restaurant) return;

const {data,error} = await supabase
.from("menu_items")
.select("*")
.eq("restaurant_id",restaurant.id)
.eq("available",true)
.order("name");

if(error){

console.log(error);

return;
}

menuData=data;

renderMenu();

}


// =====================================================
// RENDER CATEGORIES
// =====================================================

function renderCategories(){

const container =
document.getElementById("categories-scroll");

container.innerHTML =
categories.map(cat=>`

<button
onclick="selectCategory('${cat.id}')"
class="flex flex-col items-center gap-2 min-w-[70px]"
>

<div class="w-16 h-16 rounded-full overflow-hidden glass-card
${activeCategory===cat.id?"category-ring active":""}">

${cat.image_url ?

`<img src="${safeImage(cat.image_url)}"
class="w-full h-full object-cover">`

:

<div class="w-full h-full flex items-center justify-center">üçΩÔ∏è</div>

}

</div>

<span class="text-xs
${activeCategory===cat.id ?
"gradient-text font-semibold" :
"text-white/70"}">

${cat.name}

</span>

</button>

`).join("");

}


function selectCategory(id){

activeCategory=id;

renderCategories();

renderMenu();

}


// =====================================================
// FILTER MENU
// =====================================================

function getFilteredMenu(){

let filtered=[...menuData];

const search =
document.getElementById("search-input")
.value
.toLowerCase();

if(search){

filtered =
filtered.filter(item =>
item.name.toLowerCase().includes(search)
);

}

if(vegModeActive){

filtered =
filtered.filter(item=>item.is_veg);

}

if(activeCategory!="all"){

filtered =
filtered.filter(item =>
item.category_id == activeCategory
);

}

return filtered;

}


// =====================================================
// RENDER MENU
// =====================================================

function renderMenu(){

const container =
document.getElementById("menu-container");

const items = getFilteredMenu();

if(items.length==0){

container.innerHTML =
`<div class="text-center py-10">
No dishes available
</div>`;

return;

}

container.innerHTML =
items.map(item=>`

<div class="food-card glass-card rounded-2xl p-4 flex gap-4">

<div class="flex-1">

<div class="flex items-center gap-2 mb-1">

<div class="${
item.is_veg ?
"veg-badge" :
"non-veg-badge"
}"></div>

<span class="text-xs">
${item.is_veg?"Veg":"Non-Veg"}
</span>

</div>

<h4 class="font-semibold">
${item.name}
</h4>

<p class="text-xs text-white/60">
${item.description||""}
</p>

<div class="flex items-center justify-between mt-3">

<span class="gradient-text font-bold">
‚Çπ${item.price}
</span>

<button
onclick="addToCart('${item.id}')"
class="btn-gradient px-4 py-2 rounded-xl">

Add +

</button>

</div>

</div>

<div class="w-24 h-24 rounded-xl overflow-hidden">

<img
src="${safeImage(item.image_url)}"
class="w-full h-full object-cover"
loading="lazy"
>

</div>

</div>

`).join("");

}


// =====================================================
// CART
// =====================================================

function addToCart(id){

const item =
menuData.find(i=>i.id==id);

const existing =
cartItems.find(i=>i.id==id);

if(existing){

existing.qty++;

}else{

cartItems.push({

id:item.id,
name:item.name,
price:item.price,
qty:1

});

}

updateCartUI();

}


function updateCartUI(){

const totalItems =
cartItems.reduce((sum,i)=>sum+i.qty,0);

const totalPrice =
cartItems.reduce((sum,i)=>sum+i.qty*i.price,0);

const btn =
document.getElementById("cart-button-container");

if(totalItems>0){

btn.style.display="block";

document.getElementById("cart-count").innerText=totalItems;

document.getElementById("cart-total").innerText="‚Çπ"+totalPrice;

}else{

btn.style.display="none";

}

}


// =====================================================
// PLACE ORDER
// =====================================================

async function placeOrder(){

if(cartItems.length==0) return;

const total =
cartItems.reduce(
(sum,i)=>sum+i.price*i.qty,
0
);

await supabase
.from("orders")
.insert({

restaurant_id:restaurant.id,

table_number:tableNumber,

items:cartItems,

total:total,

status:"pending"

});

alert("Order placed successfully");

cartItems=[];

updateCartUI();

}


// =====================================================
// SEARCH + TOGGLE
// =====================================================

document
.getElementById("search-input")
.addEventListener("input",renderMenu);


document
.getElementById("veg-toggle")
.onclick=()=>{

vegModeActive=!vegModeActive;

renderMenu();

};


// =====================================================
// REALTIME AUTO UPDATE
// =====================================================

function enableRealtime(){

supabase
.channel("live-menu-"+restaurantSlug)
.on(
"postgres_changes",
{
event:"*",
schema:"public",
table:"menu_items"
},
()=>{

loadMenu();

}
)
.subscribe();

}


// =====================================================
// INIT SAFE LOADER
// =====================================================

async function init(){

await loadRestaurant();

await loadCategories();

await loadMenu();

enableRealtime();

}


// WAIT UNTIL PAGE READY

window.addEventListener("load",init);


</script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9d374dbfd3ae550b',t:'MTc3MjAyMzU2Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>